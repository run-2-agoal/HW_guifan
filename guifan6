星网标书
 
星网设计规范原文：
 

一、抗力学环境设计
抗力学设计规格，参考Q/CSCN XY31401-2023《空间产品环境试验规范》环境试验要求，设计要求参考鉴定级。
	模态：组件最低频率≥120Hz
	正弦振动设计要求：

表 正弦振动试验要求
试验类别	频率范围（Hz）	振动量级
（0-P）	振动轴向	扫描频率
验收试验	7～20	6.25mm	X、Y、Z	4oct/min 各轴对数从低到高扫描1次
	20～100	10g		
鉴定试验	7～20	9.375mm	X、Y、Z	2oct/min 各轴对数从低到高扫描1次
	20～100	15g		
	随机振动设计要求：
表 随机振动试验要求
频率范围（Hz）	验收	鉴定
	振动加速度功率谱密 度值（g2/Hz）	总均方根加速度（grms）	振动加速度功率谱密 度值（g2/Hz）	总均方根加速度（grms）
20~50	+6dB/oct	11.2g	+6dB/oct	17.6g
50~800	0.1g2/Hz		0.25g2/Hz	
800~2000	7～20		-6dB/oct	
振动时间：验收级每轴 1min，鉴定级每轴 2min。 
振动方向：X、Y、Z 三个方
	冲击振动设计要求：
序号	产品类型	试验方向	频率范围Hz	冲击量级	冲击次数
					
					

	加速度设计要求：
表 加速度试验条件
产品名称	试验方向及试验量级	试验量级	试验时间
单机设备	X、Y、Z向	±13g	5min
表 抗力学环境设计裕度要求
材料	裕度要求
金属	＞0
非金属	＞0.25

	设计方案：
	整机：结构方案、结构材料、加强设计——熊亮、廖书锐
从整体方案来写，架构方案需求，大概包含几块PCB，尺寸约束，因此架构方案如何选择，对于架构机械强度轻量化、强度的考虑。
从详细设计部分来看，基于确定的尺寸规格、重量约束，结构选择材料、结构加强筋设计，等来论述抗力学设计；
	单板工程：——张顺
通信盒包括2块PCB，驱动/MCU合一板和业务板，其中合一板PCB尺寸180*280mm, 板厚2.3 mm, 业务板PCB尺寸180*28 0mm, 板厚2mm.  板材分别为Hi-Tg FR4（S1000-2M）和M6G，均是航天成熟使用板材。 2块PCB通过B2B连接器互连，并设计9 pcs支撑螺柱分摊重量。
  
业务板示意图                    合一板示意图

PCB与结构件通过螺钉连接，紧固螺钉均匀分布，螺钉跨距小于100mm，并通过应力仿真评估振动冲击下PCB大形变的过应力损伤风险，薄弱位置增加结构件进行补强。



	通信盒力学分析
对模型内部光放、光模块及电源砖进行简化，盖板、前面板、底壳、盘纤架及PCB均采用实体单元，螺钉通过 MPC 单元链接安装孔。对盒体7个固定孔固定约束，进行力学仿真。
关键零部件名称	材料	质量
盖板	Al_7075-T6	0.288kg
前面板	Al_7075-T6	0.05kg
底壳	Al_7075-T6	0.585kg
盘纤架	Al_7075-T6	0.006kg
PCB	FR4	——
PCB	FR4	——
光放	——	0.35kg
海思光模块	——	0.15kg
中航光模块	——	0.045kg
灰光模块	——	0.03kg
电源砖	——	0.08kg
 
图 1-1 力学仿真模型
	模态分析 
对模型进行模态分析仿真，结果如下图所示：
   
图 1-2 模态振型图（左：1 阶，中：2 阶，右：3 阶）
表 1-1 模态统计表
模态	模态频率
1	374
2	434
3	472
通信盒一阶模态374Hz，大于120Hz，结构设计满足要求。
	正弦振动分析
对模型进行正弦振动仿真，结果如下图所示：
     
图 1-3  X向应力云图
     
图 1-4  Y向应力云图
   
图 1-5  Z向应力云图
正弦振动仿真结果汇总如下表所示：
表 1-2 正弦振动仿真结果汇总
	应力	安全裕度
X向	1.2Mpa	382.3
Y向	4.2Mpa	108.5
Z向	36.2Mpa	11.7

	应变	安全裕度
X向	54.6με	329.7
Y向	51.9με	346.8
Z向	491με	35.7

7075-T6铝合金屈服强度为 460 MPa，PCB的应变规格为<18000με，金属安全裕度大于0，非金属安全裕度大于0.25，结构设计满足正弦振动力学要求。
	随机振动分析
对模型进行正弦振动仿真，结果如下图所示：
     
图 1-6  X向应力云图
     
图 1-7  Y向应力云图
     
图 1-8  Z向应力云图
随机振动仿真结果汇总如下表所示：
表 1-3 随机振动仿真结果汇总
	3σ应力	安全裕度
X向	31.2Mpa	13.7
Y向	291.9Mpa	0.58
Z向	387.9Mpa	0.19

	3σ应变	安全裕度
X向	819με	21.0
Y向	756με	22.8
Z向	11757με	0.53

7075-T6铝合金屈服强度为 460 MPa，PCB的应变规格为<18000με，金属安全裕度大于0，非金属安全裕度大于0.25，结构设计满足随机振动力学要求。

	冲击分析
对模型进行冲击振动仿真，结果如下图所示：
     
图 1-9  X向应力应变云图
     
图 1-10  Y向应力应变云图
     
图 1-11  Z向应力应变云图
冲击振动仿真结果汇总如下表所示：
表 5-3 冲击振动仿真结果汇总
	应力	安全裕度
X向	209Mpa	1.2
Y向	244Mpa	0.89
Z向	282Mpa	0.63

	应变	安全裕度
X向	10670με	0.69
Y向	7890με	1.28
Z向	11730με	0.53

7075-T6铝合金屈服强度为 460 MPa，PCB的应变规格为<18000με，金属安全裕度大于0，非金属安全裕度大于0.25，结构设计满足冲击振动力学要求。（不考虑结构螺栓孔处应力集中点）

产品名称Product name
密级Confidentiality level
ALL	内部公开
产品版本Product version	Total 19pages 共19页
ALL	



PID虚拟风扇监控管理接口说明书





Prepared by 
拟制	刘云举,吕权明,曹国剑,李志冰,邹榕榕	Date
日期	2013/09/30
Reviewed by 
审核	吕权明,曹国剑,朱昆,李志冰,邹榕榕	Date
日期	2013/10/10
Approved by
批准	吕权明	Date
日期	2013/10/25


 


Huawei Technologies Co., Ltd. 
华为技术有限公司
All rights reserved
版权所有  侵权必究

（REP01T03 V1.1 / for internal use only）
（REP01T03 V1.1 / 仅供内部使用）
 
Revision Record 修订记录
Date
日期	Revision Version
修订
版本	CR ID / Defect ID
CR号	Sec No. 
修改
章节	Change Description
修改描述	Author
作者
2013/09/30				初稿完成	刘云举
					
					
					


 
Catalog 目  录
1	简介	6
1.1	目的	6
1.2	范围	7
1.3	接口说明	7
2	PID模块接口	7
2.1	初始化PID软件模块	7
2.2	计算PID调速信息函数或线程入口	8
2.3	配置PID调速策略参数	9
2.4	设置风扇转速PWM信息	17
3	解耦实现	18
附录１ PID接口返回值定义	20

 
Table List 表目录
表1 PID初始化接口汇总	7
表2 PID调速策略参数命令字详细定义	10
表3 配置目标温度命令数据域内容	11
表4 配置风扇属性命令数据域内容	11
表5 配置实时温度命令数据域内容	12
表6 配置实时风扇反馈转速命令数据域内容	13
表7 配置实时风扇告警命令数据域内容	13
表8 配置按照环境温度线性调速命令数据域内容	14
表9 配置功耗和目标温度对应关系命令数据域内容	15
表10 配置实时功耗的数据	16
表11 配置主备切换时的数据	17
表12 从PID调速模块获取风扇调试信息命令数据域内容	18
表13 从PID调速模块获取风扇转速PWM命令数据域内容	18
表14 ERR_CODE值定义表	21
Figures List 图目录

图1 PID在主控模式下实现解耦策略	6
图2 PID调用流程与规则(非独立线程)	8
图3 PID调用流程与规则(独立线程)	9
图4 依赖环境温度线性调速设置(台阶式)	15
图5 依赖环境温度线性调速设置(插值法)	15
图6 主备切换调用流程与规则(非独立线程)	17
图7 PID接口失败返回值组成规则	21
 

PID虚拟监控软件机电管理接口说明书
Keywords 关键词：PID、风扇、接口说明书
Abstract  摘    要：本文是PID目标温控调速软件在主机上实现时的管理模块提供的对外接口说明文档。
List of abbreviations 缩略语清单： 
Abbreviations缩略语	Full spelling 英文全名	Chinese explanation 中文解释
PID	Proportion Integral Differential
比例、积分、微分
BMC	baseboard management controller 
主板管理控制单元
PTN	Packet Transport Network	分组传送网络

























1	简介
1.1	目的
当前软件开发交付过程中测试的输入参数会经常发生变更,主机软件希望能够实现风扇调速解耦,避免频繁的软件版本变更,同时希望实现比较好的风扇调速性能, 因此选择使用基于目标温度值的风扇解耦调速策略. 将需要变更的参数通过离线配置文件或者在线自动配置方式实现,方便调测,减少代码升级.
 
图1 PID在主控模式下实现解耦策略

为此, 需要制定主机软件同风扇调速软件部分的接口协议, 以实现解耦控制, 保证两者后续都可独立升级, 且需要变更的参数尽量通过配置文件的方式, 使用BMC解析后传递给风扇调速软件部分, 实现风扇调速软件, BMC的解耦.
本文档是PID调速软件模块在主机实现时PID模块对外接口的说明文档，包括接口的名称、接口参数的定义和接口对应的具体功能说明，用于明确接口的使用方法和约束条件，指导风扇管理软件模块自身开发人员，及使用风扇管理软件模块接口的开发人员后继的设计、开发和测试工作。
1.2	范围
本文档仅描述PID调速模块软件对外提供的接口，不包括其内部的接口。
1.3	接口说明
使用PID接口前包含如下头文件即可:
TargetTempFanControl.h

2	PID模块接口
本节提供初始化PID软件模块阶段，上层软件需调用接口函数的参数和功能的说明。
表1 PID初始化接口汇总
编号	功能描述	函数接口
1	初始化入口	InitialPIDModule

2	计算PID调速信息函数或线程入口	FanControlTaskInit

3	配置目标温控调速策略参数	WriteInfo

4	转速读取接口	ReadInfo

2.1	初始化PID软件模块
函数原型：
extern signed int InitialPIDModule (void);
功能描述：调用此接口可初始化PID调速管理模块，以实现初始化全局变量的功能。
机电PID风扇调速管理模块在本函数中完成全局变量的初始化以及内部变量的初始化等处理。在PID调速模块不是独立线程时,必须在调用其他接口前调用且执行完此函数.
约束条件：
1、	在PID调速模块不是独立线程时本函数必须被调用，且只允许调用一次；
2、	本函数返回成功后，才可以正常使用；
输入参数：无
输出参数：无
返回值： 
0	-	执行成功
非0	-	执行出错，具体原因参见《附录1－PID接口返回值定义》

2.2	计算PID调速信息函数或线程入口
函数原型：
extern signed int FanControlTaskInit(void);
功能描述：如果PID模块是独立线程, 则上层软件调用此函数拉起该模块线程, 如果是非独立线程调用, 则此函数实现PID调速信息的计算功能.
约束条件：
1、	上层软件必须调用此接口；此接口需要固定每隔两秒执行1次, 如果此接口是独立线程, 有PID模块自己保证线程中每两秒执行一次, 如果此接口代表非独立线程而是计算调速的接口函数,则上层软件必须保证每隔两秒执行1次,且调用流程必须遵循如下图示
 
图2 PID调用流程与规则(非独立线程)

2、	如果PID模块是非独立的线程,则上层软件必须在初始化PID软件模块（调用InitialPIDModule函数）后调用此函数, 以便保证变量的初始化。
3、	如果是独立的线程, 则不需要调用InitialPIDModule函数。如果线程入口函数和WriteInfo不是同一个线程,需要等待线程拉起与信号量创建成功后下发.
 
图3 PID调用流程与规则(独立线程) 

输入参数：无
输出参数：无
返回值： 
0	-	执行成功
非0	-	执行出错，具体原因参见《附录1－PID接口返回值定义》
2.3	配置PID调速策略参数
函数原型
extern signed int WriteInfo(signed char* ObjTempPidBuff);
功能描述：上层软件调用本接口可设置PID目标温控调速策略的相关参数。
约束条件：
1、	本接口要在调用计算PID调速信息函数或线程入口函数后(FanControlTaskInit)才能调用；
2、	针对每条类型的数据的约束见下面；
输入参数：
signed char* ObjTempPidBuff	目标温控策略的相关参数内容，采用TLV格式定义，长度信息按照0~2047填写,编号信息取值范围0~255,温度信息为-127~127(127代表特殊含义需要全速转)，PWM百分比0-100,PWM值0~255,迟滞量-127到+127
PID参数格式定义：
参数总长度	子帧1	子帧2	…	子帧N
	Title1	Len1	Value1	Title2	Len2	Value2		
Len_L	Len_H	保留	cmd1	L1_L	L1_H	V(ID,info1, info2,．．．）	保留	cmd2	Ｌ2_L	Ｌ2_H	V2(ID,info1, info2,．．．）		
------------------(T1,L1,V1)  -------------------------------------(T2,L2,V2)  ------------------- 
          	
             Len1(子帧1的总长度)           Len2(子帧2的总长度)
其中,Len_L和Len_H表示整个数据帧的总长度.默认按照低字节在前,高字节在后的原则.

Byte[0]	参数总长度的低字节	PID参数总长度
Byte[1]	参数总长度的高字节	
Byte[2]	版本号,保留(默认填0)	子帧1  T
Byte[3]	子帧1的命令字（详细定义见表2）	
Byte[4]	子帧1总长度的低字节	子帧1  L
Byte[5]	子帧1总长度的高字节	
Byte[6]~ Byte[6+Len1]	子帧1的数据域内容（详细定义见表3）	子帧1  V
…	子帧2~子帧N（与子帧1的格式定义一致）	

表2    PID调速策略参数命令字详细定义
PID调速策略参数命令字详细定义
命令字	含义	备注（约束）
0x01	配置目标温度参数	仅需在初始化及变更时进行配置
0x02	配置风扇属性参数	仅需在初始化及变更时进行配置
0x03	刷新实时温度信息	上层需定时刷新各监控点的实时温度(建议1s 1次)不超过30S
0x04	刷新实时反馈转速	约定每10s下发一次, 反馈转速,做告警判断预留,实时性要求不高
0x05	刷新异常告警后转速	当告警产生时下发对应风扇的告警PWM,消除后填0
0x06	上层读取风扇由PID计算的待设定转速信息	转速调节实时性要求比较高,暂定为2s调用一次(上层或者部件监控板内部实现最底层的转速设定)
0x07	上层配置环境温度调速门限	初始化时或者对应关系变更时下发一次即可
0x08	上层配置功耗和目标温度对应信息	初始化时或者对应关系变更时下发一次即可
0x09	上层刷新实时功耗值	每2s下发1次cpu功耗,整机功耗
0x0a	主备切换时刷新	主机切换时需要从风扇板获取转速作为起调转速
0x0f	风扇调试信息	从PID调速模块获取风扇调试信息
约束条件：
具体约束条件需参照各个子命令数据域的内容定义下方。
2.3.1	01命令
表3    配置目标温度命令数据域内容
配置目标温度参数命令（0x01）数据域内容
字节	含义
Byte[0]	1号温度传感器编号
Byte[1]	1号温度传感器槽位号 
Byte[2]	1号温度传感器的高温告警门限
Byte[3]	1号温度传感器的目标温度
Byte[4]	迟滞量区间,保留（请填0）
Byte[5]	1号温度传感器对应的风扇个数
Byte[6]	1号温度传感器对应的风扇ID编号（根据Byte[5]的取值，1~M1个）
Byte[7]	1号温度传感器对应的风扇所在槽位号（无槽位号填风扇ID,根据Byte[5]，1~M1个） 
…	…
Byte[0+N]	K号温度传感器编号
Byte[1+N]	K号温度传感器槽位号
Byte[2+N]	K号温度传感器的高温告警门限
Byte[3+N]	K号温度传感器的目标温度
Byte[4+N]	迟滞量区间,保留（请填0）
Byte[5+N]	K号温度传感器对应的风扇个数
Byte[6+N]	K号温度传感器对应的风扇ID编号（根据Byte[5+N]的取值，1~MK个）
Byte[7+N]	K号温度传感器对应的风扇所在槽位号（无槽位号填风扇ID,按Byte[5+N]，1~MK个）
约束条件：
1、	一次性配置完所有对应关系，
2、	无目标温度和不需要参与正常PID调速的温度不在此处配置，
3、	只能在初始化及变更时进行配置， 新增加一块单板时且温度传感器编号改变必须要重新配置，否则无法根据新增单板进行调速；如果不需要此器件调速则可忽略，
4、	必须保证风扇和对应的温度传感器关系配置正确，且此接口支持分区联动配置: 即临界分区温度点可以对应多个分区。
2.3.2	02命令
表4  配置风扇属性命令数据域内容
配置风扇属性命令（0x02）数据域内容
字节	含义
Byte[0]	1号风扇的编号ID 
Byte[1]	1号风扇所在的槽位号
Byte[2]	1号风扇对应的风扇ID分区号 
Byte[3]	最大转速低字节, 如果只按照PWM调节可保留（填0）
Byte[4]	最大转速高字节, 如果只按照PWM调节可保留（填0）
Byte[5]	1号风扇允许的最小PWM百分比
…	…
Byte[0+N]	K号风扇的编号ID
Byte[1+N]	K号风扇所在的槽位号
Byte[2+N]	K号风扇对应的风扇ID分区号
Byte[3+N]	最大转速低字节, 如果只按照PWM调节可保留（填0）
Byte[4+N]	最大转速低字节, 如果只按照PWM调节可保留（填0）
Byte[5+N]	K号风扇允许的最小PWM百分比
约束条件：
1、	PWM百分比方式, 填写值的范围为0-100%，
2、	先下发01命令,再下发此命令,否则会导致数据丢失,
3、	只能在初始化，按照获取风扇最大转速调速且风扇最大转速变更， 以及风扇允许的最小PWM发生改变时重新配置，风扇发生变更时，需要重新配置。
2.3.3	03命令
表5    配置实时温度命令数据域内容
配置实时温度命令（0x03）数据域内容
字节	含义
Byte[0]	保留（填0）
Byte[1]	保留（填0）
Byte[2]	温度传感器编号
Byte[3]	温度传感器槽位号
Byte[4]	温度传感器读数（填127表示该路传感器对应风扇需要全速）
…	…
Byte[N-2]	温度传感器编号
Byte[N-1]	温度传感器槽位号
Byte[N]	温度传感器读数（填127表示该路传感器对应风扇需要全速）
约束条件：
1、	所有温度必须定期XX秒发送一次, 可以不一次下发,但是必须在XXs内发该温度一次(服务器约定为1S,其他产品根据实时性需要,但最长不超过30S)，
2、	系统刚刚启动，给PID模块下发温度时如果某个温度传感器还在初始化(不是因为故障读取不到温度)可以不下发,如果要下发必须填写为-127，
3、	因为器件单板下电不能够读取,填写最小值(-127),该路传感器计算的对应风扇转速会调到最低值，
4、	因为器件温度传感器失效, 需要全速转填写127(前提是无127度的温度且目标温度不能高于110度)，
5、	如果是因为器件温度传感器失效，不需要全速转但需要强制提升固定百分比转速用另外接口05告警下发后, 然后再将温度改为最小值(-127)，
6、	如果有的器件是休眠状态, 如果不根据休眠后调速,则可按照最小值(-127)填写， 保证比目标温度值低5度以上，
7、	新增或删除一块单板或者器件需要参与调速, 必须重新完成配置一次。
2.3.4	04命令
表6    配置实时风扇反馈转速命令数据域内容
配置实时风扇反馈转速命令（0x04）数据域内容
字节	含义
Byte[0]	1号风扇的编号ID
Byte[1]	1号风扇所在的槽位号
Byte[2]	1号风扇反馈转速百分比,0-100%
…	…
Byte[0+N]	K号风扇的编号ID 
Byte[1+N]	K号风扇所在的槽位号
Byte[2+N]	K号风扇反馈转速百分比0-100%
约束条件：
1、	约定每10s下发一次, 反馈转速,做告警判断预留,实时性要求不高
2.3.5	05命令
表7    配置实时风扇告警命令数据域内容
配置实时风扇告警命令（0x05）数据域内容
字节	含义
Byte[0]	1号风扇的编号ID
Byte[1]	1号风扇所在的槽位号
Byte[2]	1号风扇对应的告警后的PWM百分比(0-100%)
…	…
Byte[0+N]	K号风扇的编号ID 
Byte[1+N]	K号风扇所在的槽位号
Byte[2+N]	K号风扇对应的告警后的PWM百分比(0-100%)
约束条件：
1、	温度传感器等器件有异常告警时，需要调高对应风扇转速，此场景下必须下发；调速将按照告警优先调节；
2、	如果当前某个风扇对应了多个告警时填写最大的告警PWM即可, 如果某个告警消除了, 需要在剩余的告警中选取最高的告警PWM下发，
3、	如果全部告警清除后务必填0，必须下发一次，
4、	告警PWM字段在风扇没有告警时填充填0， 可以不下发。

2.3.6	07命令
表8    配置按照环境温度线性调速命令数据域内容
配置按照环境温度线性调速（0x07）数据域内容
字节	含义
Byte[0]	曲线1保留字节
Byte[1]	曲线1迟滞量
Byte[2]	曲线1环境温度传感器ID编号
Byte[3]	曲线1环境温度传感器所在槽位号 
Byte[4]	曲线1对应的风扇个数N
Byte[5]	曲线1风扇1编号ID
Byte[6]	曲线1风扇1所在槽位号
…	…
	曲线1风扇N编号ID
	曲线1风扇N所在槽位号
	曲线1环境温度区间个数K
	曲线1第一环境温度区间左值
	曲线1第一环境温度区间右值
	曲线1第一环境温度区间左值对应的PWM百分比
	曲线1第一环境温度区间右值对应的PWM百分比
…	…
	曲线1第K个环境温度区间左值
	曲线1第K个环境温度区间右值
	曲线1第K环境温度区间左值对应的PWM百分比
	曲线1第K环境温度区间右值对应的PWM百分比
…	…
	曲线M的保留字节
	曲线M迟滞量
…	…

约束条件：
1、	按照环境温度线性调速时必须配置此命令；不配置默认不按照环境温度调速，配置此命令前需 配置02命令;
2、	一般此命令在配置时下发一次即可， 当如果环境温度区间对应的转速关系发生变化时需要重新完整和配置一次，调速模块每次按照最新配置执行，
3、	关于左值和右值填法, 为算法实现需要, 特约定按照环境温度由低到高的方式依次填写.例如: [0,25] [20,20][25,28] [25,25][28,30][30,30]….,如果是斜线时,则左右PWM百分比可以填写低斜线左端点和右端点(图四)。最后一个区间温度请填写到127.
 
图4 依赖环境温度线性调速设置(台阶式)

 
图5 依赖环境温度线性调速设置(插值法)
2.3.7	08命令
表9    配置功耗和目标温度对应关系命令数据域内容
配置功耗和目标温度关系（0x08）数据域内容
字节	含义
Byte[0]	CPU1的温度传感器ID
Byte[1]	CPU1的温度传感器所在槽位号 
Byte[2]	保留字节
Byte[3]	CPU1功耗迟滞量
Byte[4]	保留字节
Byte[5]	目标温度个数(1-N个)
Byte[6]	目标温度1
Byte[7]	功耗左值
Byte[8]	功耗右值
…	…
	目标温度N
	功耗N左值
	功耗N右值
Byte[0]	CPU2的温度传感器ID
Byte[1]	CPU2的温度传感器所在槽位号 
Byte[2]	保留字节
Byte[3]	CPU2功耗迟滞量
Byte[4]	保留字节
Byte[5]	CPU2的目标温度个数(1-N个)
	目标温度1
	功耗左值
	功耗右值
	…
	目标温度N
	功耗N左值
	功耗N右值

约束条件：
1、	支持传感器ID多目标配置使用。
2、	功耗上下限和迟滞量需要配置。
3、	关于左值和右值填法, 为算法实现需要, 特约定按照功耗由低到高的方式依次填写.
2.3.8	09命令
表10    配置实时功耗的数据
配置实时功耗（0x09）数据域内容
字节	含义
Byte[0]	总功耗低字节
Byte[1]	总功耗高字节
Byte[2]	1号CPU的温度传感器的ID
Byte[3]	1号CPU的温度传感器的槽位号
Byte[4]	1号CPU的实时功耗,0-255
…	2号CPU的温度传感器的ID
	2号CPU的温度传感器的槽位号
…	2号CPU的实时功耗,0-255
…	…
...	N号CPU的温度传感器的ID
	N号CPU的温度传感器的槽位号
	N号CPU的实时功耗,0-255
约束条件：
1、	需要根据功耗动态调整目标值时下发此信息。
2.3.9	0a命令
表11    配置主备切换时的数据
配置主机切备份时同步信息（0x0a）数据域内容
字节	含义
Byte[0]	1号风扇的编号ID
Byte[1]	1号风扇所在的槽位号ID
Byte[2]	1号风扇获取的PWM,用0~255表示
…	…
Byte[0+N]	K号风扇的编号ID
Byte[1+N]	K号风扇所在的槽位号ID
Byte[2+N]	K号风扇获取的PWM,用0~255表示
约束条件：
1、	主备切换时, 需要从风机盒获取转速PWM值下发此命令给PID调速模块;在调用此命令前应该有初始化InitialPIDModule, 
2、	如果返回失败值需要重发，说明主机配置没有完成；返回成功说明主机配置完成，此命令不能再次下发。
 
图6 主备切换调用流程与规则(非独立线程)

2.3.10	0f命令
表12    从PID调速模块获取风扇调试信息命令数据域内容
从PID调速模块获取风扇调试信息命令（0x0F）数据域内容
字节	含义
Byte[0]	调试信息类型(0版本号，1配置信息，2控制信息)
Byte[1]	开1/关0
约束条件：
1、	本接口要在初始化PID软件模块及配置指定的机电部件参数成功后, 以及风扇转速计算后才能调用；
2、	版本号是查询一次打印一次，配置信息和控制信息是通过参数控制开关；
2.4	获取风扇转速PWM信息
函数原型
extern signed int ReadInfo(signed  char* ObjTempPidBuff);
功能描述：调用本接口可设置各分区风扇的转速和PWM信息。
表13    从PID调速模块获取风扇转速PWM命令数据域内容
从PID调速模块获取风扇转速PWM命令（0x06）数据域内容
字节	含义
Byte[0]	1号风扇的编号ID
Byte[1]	1号风扇所在的槽位号ID
Byte[2]	1号风扇待设定转速低字节, 如果只按照PWM调节可保留
Byte[3]	1号风扇待设定大转速高字节, 如果只按照PWM调节可保留
Byte[4]	1号风扇待设定的PWM(取值为0-255)
…	…
Byte[0+N]	K号风扇的编号ID
Byte[1+N]	K号风扇所在的槽位号ID
Byte[2+N]	K号风扇待设定转速低字节, 如果只按照PWM调节可保留（填0）
Byte[3+N]	K号风扇待设定最大转速低字节, 如果只按照PWM调节可保留（填0）
Byte[4+N]	K号风扇待设定的PWM取值为0-255

约束条件：
1.	本接口要在初始化PID软件模块及配置指定的机电部件参数成功后, 以及风扇转速计算后才能调用；
2.	本接口约定每2S调用一次；
3.	如果在配置风扇最大转速中，没有配置或者因为风扇差异粗略配置了最大转速，则上层不能够按照设定转速信息取值，只能按照PWM信息取值.
4.	PWM此处取值范围为0-255, 在获取到该值发给风扇时,如果是8位精度,为保证调速精度请直接下发。

输入参数：无
输出参数：
signed char* ObjTempPidBuff	上层软件获取转速和PWM信号，采用TLV格式定义，详细说明表格9,PWM信号为0-255表示

返回值：
0	-	执行成功
非0	-	执行出错，具体原因参见《附录1 PID接口返回值定义》
2.5	日志接口注册
函数原型
extern unsigned int PIDRegWriteLogFn(PID_REGLOG_FN pfnRegLog);
PID_REGLOG_FN pfnRegLog 函数原型为：
typedef UINT32 (*PID_REGLOG_FN)(const CHAR * pcModName, const CHAR* pcLogLevel, CHAR *acLineBuf,UINT32 ulLen);
功能描述：调用本接口为风扇注册写日志接口
约束条件：
1.	本接口要在初始化PID软件模块之后才能调用；
2.	上层可以不给风扇模块注册写日志函数，如不注册，风扇则不记录日志；
输入参数：
PID_REGLOG_FN pfnRegLog	上层软件传入的挂接函数
输出参数：无 
返回值：
0	-	执行成功
非0	-	执行出错，具体原因参见《附录1 PID接口返回值定义》

3	解耦实现
配置信息通过离线文件或在线配置的方式实现,通过主机模块(BMC)解析下发给PID风扇控制模块,后续不需要软件版本升级.
另外,如果风扇控制软件有自己的独立线程, 计算转速不依赖于主控(BMC等)上层管理软件的线程, 理论上只要上层管理软件查询并设定风扇转速信息的周期不超过30S即可. 理论上温度下发信息能做到30秒即可. 但为了实时性要求以及对过冲响应的要求, 本版约束BMC软件下发温度信息1秒1次, 查询并设定转速2s一次, PID风扇控制模块每2s刷新风扇转速.为后续扩展需要, BMC软件需要下发转速反馈信息, 暂时约定为每10s下发一次.

附录１ PID接口返回值定义
PID接口返回值共4个字节，返回全0表示执行成功，返回非0值表示执行失败，详细失败返回值组成及解析规则如下图所示： 
 
图7 PID接口失败返回值组成规则
其中bit31-bit16表示代码行号；bit15-bit8表示内部文件模块号；bit7-bit0表示失败错误码，失败错误码（ERR_CODE）的详细说明见下表。
表14 ERR_CODE值定义表
接口返回值	描述	宏定义
0x01	通用执行失败	PID_ERR_ERROR
0x02	输入参数非法	PID_ERR_INVALID_PARAMETER
0x03	信号量创建错误	PID_ERR_SEG_CREATE
0x04	信号量P错误	PID_ERR_SEG_P
0x05	信号量V错误	PID_ERR_SEG_V
0x06	线程创建错误	PID_ERR_THREAD
0X07	未配置就调速	PID_ERR_NO_SDR
0X08	未配置01就倒换主备	PID_ERR_NO_SDR01
0X09	未配置02就倒换主备	PID_ERR_NO_SDR02
		


